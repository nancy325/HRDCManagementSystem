@model HRDCManagementSystem.Models.TrainingViewModel
@using Microsoft.AspNetCore.Mvc.Rendering

@{
    ViewData["Title"] = "Training Registration";
}

<div class="container mt-4">
    <h2 class="mb-2">Training Registration</h2>
    <p class="text-muted">Discover and register for upcoming training programs</p>

    <!-- Search + Filter -->
    <form method="get" asp-action="TrainingRegistration" class="row g-2 mb-4">
        <div class="col-md-6">
            <input type="text" name="searchTerm" value="@Model.SearchTerm"
                   class="form-control" placeholder="Search by title, description, or trainer..." />
        </div>
        <div class="col-md-4">
            @Html.DropDownList("filterCategory", new List<SelectListItem>
            {
                new SelectListItem { Text = "All Categories", Value = "all", Selected = Model.FilterCategory == "all" },
                        new SelectListItem { Text = "Technical", Value = "Technical", Selected = Model.FilterCategory == "Technical" },
                        new SelectListItem { Text = "Management", Value = "Management", Selected = Model.FilterCategory == "Management" },
                        new SelectListItem { Text = "Soft Skills", Value = "Soft Skills", Selected = Model.FilterCategory == "Soft Skills" },
                        new SelectListItem { Text = "Finance", Value = "Finance", Selected = Model.FilterCategory == "Finance" }
                        }, new { @class = "form-select" })
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>
    </form>

    <!-- Toast/Message -->
    @if (TempData["Message"] != null)
    {
        <div class="alert alert-info">@TempData["Message"]</div>
    }

    <p class="text-muted">Showing @Model.Trainings.Count trainings</p>

    <!-- Training Cards -->
    <div class="row">
        @foreach (var training in Model.Trainings)
        {
            <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">@training.Title</h5>
                        <h6 class="card-subtitle mb-2 text-muted">@training.Category</h6>
                        <p class="card-text">@training.Description</p>

                        <ul class="list-unstyled small mb-3">
                            <li><strong>Date:</strong> @training.Date</li>
                            <li><strong>Time:</strong> @training.Time</li>
                            <li><strong>Venue:</strong> @training.Venue</li>
                            <li><strong>Trainer:</strong> @training.Trainer</li>
                            <li><strong>Capacity:</strong> @training.Enrolled/@training.Capacity</li>
                            <li><strong>Duration:</strong> @training.Duration</li>
                            <li><strong>Prerequisites:</strong> @training.Prerequisites</li>
                            <li><strong>Status:</strong> @training.Status</li>
                        </ul>

                        @if (training.IsRegistered)
                        {
                            <button class="btn btn-secondary w-100" disabled>Already Registered</button>
                        }
                        else if (training.Status == "full")
                        {
                            <button class="btn btn-danger w-100" disabled>Training Full</button>
                        }
                        else
                        {
                            <form asp-action="Register" method="post">
                                <input type="hidden" name="trainingId" value="@training.Id" />
                                <button type="submit" class="btn btn-success w-100">Register Now</button>
                            </form>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    @if (Model.Trainings.Count == 0)
    {
        <div class="alert alert-warning text-center">
            No trainings found. Try adjusting your search or check back later.
        </div>
    }
</div>
