@functions {
    string IsActive(string controller, string? action = null)
    {
        var routeData = ViewContext.RouteData;
        var currentController = routeData.Values["controller"]?.ToString();
        var currentAction = routeData.Values["action"]?.ToString();

        bool controllerMatches = string.Equals(controller, currentController, StringComparison.OrdinalIgnoreCase);
        bool actionMatches = string.IsNullOrEmpty(action) || string.Equals(action, currentAction, StringComparison.OrdinalIgnoreCase);

        return controllerMatches && actionMatches ? "active" : "";
    }

    string IsActiveByPath(string path)
    {
        var currentPath = Context.Request.Path.Value?.ToLower() ?? "";
        var targetPath = path.ToLower();
        
        // Exact match or starts with (for nested routes)
        if (currentPath == targetPath || currentPath.StartsWith(targetPath + "/"))
        {
            return "active";
        }
        return "";
    }

    string GetCleanUserName()
    {
        var raw = User.Identity?.Name ?? "Admin User";

        // If it's an email → remove @domain
        if (raw.Contains("@"))
            raw = raw.Split('@')[0];

        // Replace . and _ with space
        raw = raw.Replace(".", " ").Replace("_", " ");

        // Title case
        return System.Globalization.CultureInfo.CurrentCulture.TextInfo
            .ToTitleCase(raw);
    }
}

<style>
    /* SIDEBAR CONTAINER */
    .admin-sidebar {
        width: 250px;
        flex-shrink: 0;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    /* LOGO SECTION */
    .sidebar-logo-container {
        text-align: center;
        padding: 22px 0 18px;
        border-bottom: 1px solid #eee;
    }

    .sidebar-logo {
        height: 55px;
        object-fit: contain;
        margin-bottom: 6px;
    }

    .sidebar-title {
        font-size: .95rem;
        font-weight: 600;
        color: #0d6efd;
        letter-spacing: .3px;
    }

    /* NAVIGATION */
    .sidebar-nav {
        padding: 14px 8px;
        flex-grow: 1; /* Keeps footer at bottom */
        overflow-y: auto;
    }

    .nav-item {
        margin-bottom: 4px;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 11px 14px;
        color: #333;
        font-size: .94rem;
        border-radius: 8px;
        transition: 0.15s;
        font-weight: 500;
        text-decoration: none;
    }

        .nav-link:hover {
            background: #eef4ff;
            color: #0d6efd;
            transform: translateX(3px);
        }

        .nav-link.active {
            background: #e3ecff;
            color: #0d6efd;
            font-weight: 600;
            border-left: 4px solid #0d6efd;
            padding-left: 12px !important;
        }

    .nav-icon {
        font-size: 1.2rem;
        width: 22px;
        margin-right: 12px;
        color: inherit;
    }

    /* FOOTER */
    .sidebar-footer {
        padding: 16px 16px;
        border-top: 1px solid #e6e6e6;
        background: #fafbfd;
    }

    .admin-info {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
    }

    /* PERFECT ROUND AVATAR — NEVER OVAL */
    .admin-avatar {
        width: 42px;
        height: 42px;
        aspect-ratio: 1 / 1;
        background: #0d6efd;
        color: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.1rem;
        margin-right: 10px;
        border: 2px solid #dbe4ff;
    }

    .btn-logout {
        width: 100%;
        border-radius: 6px;
        padding: 7px;
        font-size: .9rem;
        font-weight: 600;
    }
</style>


<div class="admin-sidebar">

    <!-- LOGO -->
    <div class="sidebar-logo-container">
        <img src="~/images/hrdc-logo.png" class="sidebar-logo" />
        <div class="sidebar-title">HRDC Admin</div>
    </div>

    <!-- NAVIGATION -->
    <ul class="sidebar-nav list-unstyled">

        <li class="nav-item">
            <a href="/Admin/Dashboard" class="nav-link @IsActive("Admin", "Dashboard")">
                <i class="nav-icon bi bi-speedometer2"></i> Dashboard
            </a>
        </li>

        <li class="nav-item">
            <a href="/AdminReport/Reports" class="nav-link @IsActive("AdminReport", "Reports")">
                <i class="nav-icon bi bi-graph-up"></i> Training Reports
            </a>
        </li>

        <li class="nav-item">
            <a href="/Admin/Employees" class="nav-link @IsActive("Employee", "Employees")">
                <i class="nav-icon bi bi-people"></i> Employees
            </a>
        </li>

        <li class="nav-item">
            <a href="/Training/TrainingIndex" class="nav-link @IsActive("Training", "TrainingIndex")">
                <i class="nav-icon bi bi-mortarboard"></i> Trainings
            </a>
        </li>

        <li class="nav-item">
            <a href="/Admin/Registrations" class="nav-link @IsActive("Admin", "Registrations")">
                <i class="nav-icon bi bi-clipboard-check"></i> Registrations
            </a>
        </li>

        <li class="nav-item">
            <a href="/Admin/Attendance" class="nav-link @IsActive("Attendance", "Index")">
                <i class="nav-icon bi bi-calendar-check"></i> Attendance
            </a>
        </li>

        <li class="nav-item">
            <a asp-controller="Assessment" asp-action="Index"
               class="nav-link @IsActive("Assessment", "Index")">
                <i class="nav-icon bi bi-clipboard-data"></i> Assessment
            </a>
        </li>

        <li class="nav-item">
            <a asp-controller="Certificate" asp-action="Index"
               class="nav-link @IsActive("Certificate")">
                <i class="nav-icon bi bi-award"></i> Certificates
            </a>
        </li>

        <li class="nav-item">
            <a href="/Notification/Index" class="nav-link @IsActive("Notification", "Index")">
                <i class="nav-icon bi bi-bell"></i> Notifications
            </a>
        </li>

        <li class="nav-item">
            <a href="/Feedback/TrainingFeedbacks" class="nav-link @IsActive("Feedback", "TrainingFeedbacks")">
                <i class="nav-icon bi bi-chat-left-text"></i> Feedback
            </a>
        </li>

        <li class="nav-item">
            <a asp-controller="Account" asp-action="Settings"
               class="nav-link @IsActive("Account", "Settings")">
                <i class="nav-icon bi bi-gear"></i> Settings
            </a>
        </li>

    </ul>

    <!-- FOOTER -->
    <div class="sidebar-footer">

        <div class="admin-info">
            <div class="admin-avatar">
                <i class="bi bi-person-fill"></i>
            </div>
            <div>
                <div class="fw-semibold">@GetCleanUserName()</div>
                <small class="text-muted">System Administrator</small>
            </div>
        </div>

    </div>
</div>
