@model IEnumerable<HRDCManagementSystem.Models.ViewModels.TrainingViewModel>

@{
	ViewData["Title"] = "Trainings";
	// Filter the trainings for employees: only show published
	IEnumerable<HRDCManagementSystem.Models.ViewModels.TrainingViewModel> trainingsToShow;
	var currentDate = DateOnly.FromDateTime(DateTime.Now);
	if (User.IsInRole("Employee"))
	{
		trainingsToShow = Model.Where(t => t.Status != null && t.Status.ToLower() == "published" && t.EndDate > currentDate);
	}
	else
	{
		trainingsToShow = Model;
	}
}

<div class="container mt-4">
	<h2 class="mb-3">Trainings</h2>
	@if (User.IsInRole("Admin"))
	{
		<div class="mb-3">
			<a asp-action="CreateTraining" asp-controller="Training" class="btn btn-primary">Create Training</a>
		</div>
	}
    <table class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Sr.No.</th>
				<th>Title</th>
				<th>Trainer</th>
				<th>Start Date</th>
				<th>End Date</th>
				<th>Venue</th>
				<th>Status</th>
				<th>Mode</th>
				<th style="width:180px;">Actions</th>
			</tr>
		</thead>
		<tbody>
			@for (int i = 0; i < trainingsToShow.Count(); i++)
			{
				var t = trainingsToShow.ElementAt(i);
				<tr>
					<td>@(i + 1)</td>
					<td>@t.Title</td>
					<td>@t.TrainerName</td>
					<td>@t.StartDate.ToShortDateString()</td>
					<td>@t.EndDate.ToShortDateString()</td>
					<td>@t.Venue</td>
					<td>@t.Status</td>
					<td>@t.Mode</td>
					<td>
						<a asp-action="Details" asp-route-id="@t.TrainingSysID" class="btn btn-sm btn-info">Details</a>
						@if (User.IsInRole("Admin"))
						{
							<a asp-action="EditTraining" asp-route-id="@t.TrainingSysID" class="btn btn-sm btn-warning">Edit</a>
							<a asp-action="DeleteTraining" asp-route-id="@t.TrainingSysID" class="btn btn-sm btn-danger">Delete</a>
						}
						else if (User.IsInRole("Employee"))
						{
							<form asp-action="Register" asp-controller="TrainingRegistration" method="post" class="d-inline">
								@Html.AntiForgeryToken()
								<input type="hidden" name="trainingId" value="@t.TrainingSysID" />
								<button type="submit" class="btn btn-sm btn-primary">Register</button>
							</form>
						}
					</td>
				</tr>
			}
		</tbody>

	</table>
</div>
@if (TempData["SuccessMessage"] != null)
{
	<div class="alert alert-success">
		@TempData["SuccessMessage"]
	</div>
}
